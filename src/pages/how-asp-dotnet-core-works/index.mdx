import { Lecture, SlackMessage, TimelineOfContents, Level, ThatsAllFolks } from "../../components";
import { FontAwesomeIcon } from "@fortawesome/react-fontawesome";
import { faGlobe } from "@fortawesome/pro-solid-svg-icons";
import { faFacebookSquare, faGithub } from "@fortawesome/free-brands-svg-icons";
import { nikitaKrasnov2018Avatar } from "../../assets/images/avatars/intro-rounded";
import {
SnippetL02S01,
SnippetL02S02,
SnippetL02S03,
SnippetL03S01,
SnippetL03S02,
SnippetL03S03,
SnippetL03S04,
SnippetL03S05,
SnippetL04S01,
SnippetL04S02,
SnippetL04S03,
SnippetL04S04,
SnippetL04S05,
SnippetL04S06
} from "./assets/snippets";
import './styles.css';


<div><h1><strong>How ASP.NET Core works</strong></h1></div>

<div>
  <div class="author">
    <div id="avatar-wrapper">
      <object id="avatar" data={nikitaKrasnov2018Avatar} role="img" aria-label="My profile picture"></object>
    </div>
    <div class="profile">
      <h3 class="name">–ù–∏–∫–∏—Ç–∞ –ö—Ä–∞—Å–Ω–æ–≤</h3>
      <ul class="contacts">
        <li>
          <a href="https://www.facebook.com/krsnv" rel="author" class="facebook">
            <FontAwesomeIcon icon={faFacebookSquare} className="icon" />
            <span>Nikita Krasnov</span>
          </a>
        </li>
        <li>
          <a href="https://github.com/EclipticaSonos" rel="author" class="github">
            <FontAwesomeIcon icon={faGithub} className="icon" />
            <span>EclipticaSonos</span>
          </a>
        </li>
        <li><a href="https://www.linkedin.com/in/nikita-krasnov-b51244116/" rel="author" class="linkedin"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin" class="svg-inline--fa fa-linkedin fa-w-14 icon" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg><span>nikita-krasnov</span></a></li>
      </ul>
      <p class="about">
        –ù—ñ–∫—ñ—Ç–∞ –ø—Ä–∞—Ü—é—î –±–µ–∫–µ–Ω–¥-—Ä–æ–∑—Ä–æ–±–Ω–∏–∫–æ–º –≤ <a href="https://binary-studio.com"><strong>Binary Studio</strong></a>. –í—ñ–Ω –Ω–µ –≤–∂–∏–≤–∞—î –∞–ª–∫–æ–≥–æ–ª—é, –∞–ª–µ –≤–∂–∏–≤–∞—î .NET-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∏, –µ–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É –º—É–∑–∏–∫—É, —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–µ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è —ñ —Ñ—É—Ç–±–æ–ª–∫–∏ –∑ –ø—Ä—ñ–Ω—Ç–∞–º–∏-–º–µ–º–∞–º–∏. –í—ñ–¥–≤—ñ–¥—É—î —Ç–µ—Ö–Ω—ñ—á–Ω—ñ –º—ñ—Ç–∞–ø–∏ —Ç–∞ –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü—ñ—ó, —ñ –≤–∞–º —Ä–∞–¥–∏—Ç—å —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ ‚Äî –ø—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –¥–æ–º–∞—à–Ω—å–æ–≥–æ –∑–∞–≤–¥–∞–Ω–Ω—è –¥–ª—è —Ü—ñ—î—ó –ª–µ–∫—Ü—ñ—ó ü§™
      </p>
    </div>
  </div>
  <div class="bubble" style="margin: -0.5em 1em 1em;">
    <strong>Hello guys!</strong><br />I am giving notes for this lecture in English, because for every developer <em>(and I hope you are going to become ones!)</em> it is important to be able to read documentation, which is rarely translated from English. On the way I will give you all hints and guidelines neccessary to understand how our tech stack works, and by the end of this lesson you will have live web app in ASP.NET Core. 
    <br />
    Want to try it out? Set up your workplace and let's go!
  </div>
</div>

<div id="table-of-contents" class="table-of-contents">
  <TimelineOfContents timeline={[{
    linkTo: "#intro-to-dotnet-core",
    title: "Intro to .NET Core"
  }, {
    linkTo: "#creating-an-app",
    title: "Creating an app"
  }, {
    linkTo: "#controllers-and-services",
    title: "Controllers and services"
  }, {
    linkTo: "#additional-features",
    title: "Additional Features"
  }]} />
</div>


<Level id="intro-to-dotnet-core" number="1" name="Intro to .NET Core" difficulty="No worries" objectives="Familiarize yourself with .NET basics because you are going to be buddies." />

<h5>How did Microsoft come up with .NET Core</h5>

There were times when the term <strong>".NET"</strong> meant Windows platform only. It imposed some restrictions for deploying, because most machines have Linux as operating system. So the guys in Microsoft gathered for a meeting and came up with .NET Core. The main idea of the framework is cross-platform apps, which means you can host your app on a variety of OS. Furthermore, it‚Äôs open-source, hence it has great community support.

<h5>.NET Core advantages</h5>

1. **Cross-platform**  
   Runs on Windows, Linux, macOS
2. **Flexible deployment**  
   The framework can be included in your app or installed side-by-side user-or machine-wide
3. **Command-line tools**  
   .NET Core has great CLI, therefore all product scenarios can be executed using command-line
4. **Compatibility**  
   .NET Core is compatible with .NET Framework, Xamarin and Mono, via the .NET Standard Library
5. **Open-source**  
   The .NET Core platform is open source, using MIT and Apache 2 licenses. You are welcome to contribute
6. **Supported by Microsoft**  
   Huge corporation forces .NET Core to develop and gain new features

<h5>What you can build with .NET Core</h5>

<div class="columns">
  <div class="column col-4">
    <div class="panel">
      <div class="panel-header">
        <strong>ASP.NET Core MVC</strong>
      </div>
      <div class="panel-body">
        Web apps which implement Model-View-Controller pattern and use Razor for HTML markdown with C# snippets
      </div>
    </div>
  </div>
  <div class="column col-4">
    <div class="panel">
      <div class="panel-header">
        <strong>ASP.NET Core WebAPI</strong>
      </div>
      <div class="panel-body">
        Backend app which implements business logic and can be used by any client <em>(whether it‚Äôs Angular-, React-, or WhateverFramework-based frontend, mobile apps, etc.)</em>
      </div>
    </div>
  </div>
  <div class="column col-4">
    <div class="panel">
      <div class="panel-header">
        <strong>UWP (Universal Windows Platform)</strong>
      </div>
      <div class="panel-body">
        Native applications for phones, laptops, tablets, XBox, IoT
      </div>
    </div>
  </div>
</div>

<h5>What you need to start</h5>
* **.NET Core SDK** includes everything you need to build and run .NET Core applications. Since you are not limited to Windows only, you can choose whatever IDE or text editor you want (<a href="https://visualstudio.microsoft.com/"><strong>Visual Studio</strong></a>, <a href="https://code.visualstudio.com/"><strong>Visual Studio Code</strong></a>, <a href="https://www.jetbrains.com/rider/"><strong>JetBrains Rider</strong></a>, <a href="https://www.sublimetext.com/"><strong>Sublime</strong></a>, <a href="https://atom.io/"><strong>Atom</strong></a>, and so on). You are able to write code using your favorite tool and execute needed actions using the CLI. Some useful CLI commands are:

  * `dotnet new` ‚Äî initializes a sample console C# project
  * `dotnet restore` ‚Äî restores the dependencies for a given application
  * `dotnet build` ‚Äî builds a .NET Core application
  * `dotnet publish` ‚Äî publishes a .NET portable or self-contained application
  * `dotnet run` ‚Äî runs the application from source
  * `dotnet test` ‚Äî runs tests using a test runner specified in the project.json
  * `dotnet pack` ‚Äî creates a NuGet package of your code

* **.NET Runtime** includes just the resources required to run existing .NET Core applications (this runtime is included in the SDK)

<Level id="creating-an-app" number="2" name="Creating an app" difficulty="It gets warmer, some actual copypasting is required" objectives="Bring a starter of ASP.NET Core web app to your console." />

<h5>What is ASP.NET Core</h5>
**ASP.NET** is a popular web-development framework for building web apps on the .NET platform. **ASP.NET Core** is the open-source version of ASP.NET, that runs on macOS, Linux, and Windows. It was first released in 2016 and is a re-design of earlier Windows-only versions of ASP.NET. In comparison to ASP.NET, Core version provides:

* Cleaner and modular architecture
* Tighter security
* Reduced servicing
* Improved performance

<h5>Why use it</h5>

* Integration of modern client-side frameworks and development workflows
* A cloud-ready environment-based configuration system
* Built-in dependency injection
* New light-weight and modular HTTP request pipeline
* Ability to host on IIS or self-host in your own process
* Built on .NET Core, which supports true side-by-side app versioning
* Ships entirely as NuGet packages
* New tooling that simplifies modern web development
* Build and run cross-platform ASP.NET apps on Windows, Linux and macOS
* Open-source and community focused

<h5>Create a new app by running <code>dotnet new webapi</code> <sup><strong><a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/startup?view=aspnetcore-2.2">[1]</a></strong></sup></h5>
<h6>Program.cs</h6>
This is how the entry point looks like: 
<SnippetL02S01 />
<h6>Startup.cs</h6>
<ul>
  <li>
    <code>Configure</code> ‚Äî how the application will respond to individual HTTP requests (you can setup pipelines which will process requests):
    <SnippetL02S02 />
  </li>
  <li>
    <code>ConfigureServices</code> ‚Äî method for configuring services that are used by your application:
    <SnippetL02S03 />
  </li>
</ul>

<Level id="controllers-and-services" number="3" name="Controllers and services" difficulty="No kidding" objectives="Write, run and test API." />

I‚Äôm going to show you how we can write API using **ASP.NET Core WebAPI**. We will be able to get a list of users and get user by id. <a href="https://jsonplaceholder.typicode.com/"><strong>JsonPlaceholder</strong></a> will be used for data set.

1. First, let‚Äôs run the application we‚Äôve just created. You can use `dotnet run` command to start the server. To make sure that our API is working, we should send a request to the `ValuesController` that was created by default. Open [**https://localhost:5001/api/values**](**https://localhost:5001/api/values**) ‚Äî you should receive `["value1","value2"]` JSON as a response.
   <div class="bubble small subtle">
     –¢—ã –º–æ–∂–µ—à—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Postman –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–≤–æ–µ–≥–æ API, –Ω–æ —è —Ä–µ–∫–æ–º–µ–Ω–¥—É—é –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–ª—è VSCode ‚Äï <a href="https://marketplace.visualstudio.com/items?itemName=humao.rest-client"><strong>REST Client</strong></a>
   </div>

2. Let‚Äôs practise a bit more and create a new **WebAPI Controller** controller. Create a new file called **UsersController.cs** in the **Controllers** folder. Add two GET methods which will return a list of users and a user by his id. Use `ValuesController` as an example. Eventually you should have something like this:
   <ul>
     <li class="details">
       <input type="checkbox" id="accordion-3-1" />
       <label class="summary" for="accordion-3-1">
         <strong>UsersController.cs</strong>
       </label>
       <div class="details-body">
         <SnippetL03S01 />
       </div>
     </li>
   </ul>
3. Start the application and go check [**https://localhost:5001/api/values**](**https://localhost:5001/api/values**) to make sure that your new controller is available.
4. Writing business logic in controllers isn‚Äôt the best idea, so it would be better if we created a separate service for this purpose ‚Äî let's call it **UserService**:
   <ul>
     <li class="details">
       <input type="checkbox" id="accordion-3-3" />
       <label class="summary" for="accordion-3-3">
         <strong>UsersService.cs</strong>
       </label>
       <div class="details-body">
         <SnippetL03S03 />
       </div>
     </li>
     <li class="details">
       <input type="checkbox" id="accordion-3-2" />
       <label class="summary" for="accordion-3-2">
         <strong>UsersController.cs</strong>
       </label>
       <div class="details-body">
         <SnippetL03S02 />
       </div>
     </li>
   </ul>
5. Run the application and test [**https://localhost:5001/api/values**](**https://localhost:5001/api/values**) again to make sure everything works as before.
6. In the next step I suggest implementing <strong>remote data loading</strong> using JsonPlaceholder service. In order to serialize response we will need to add a package that works with JSON. Use `dotnet add package Newtonsoft.Json` command to install the package.
   <ul>
     <li class="details">
       <input type="checkbox" id="accordion-3-4" />
       <label class="summary" for="accordion-3-4">
         <strong>UsersController.cs</strong>
       </label>
       <div class="details-body">
         <SnippetL03S04 />
       </div>
     </li>
     <li class="details">
       <input type="checkbox" id="accordion-3-5" />
       <label class="summary" for="accordion-3-5">
         <strong>UsersService.cs</strong>
       </label>
       <div class="details-body">
         <SnippetL03S05 />
       </div>
     </li>
   </ul>

<Level id="additional-features" number="4" name="Additional features" difficulty="I know kung-fu" objectives="Learn how to talk in .NET dialect." />

<h4>Short review of Dependency Injection (Singleton, Scoped, Transient)</h4>

<a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/dependency-injection?view=aspnetcore-2.2"><strong>Dependency injection (DI)</strong></a> ‚Äî software design pattern, which is a technique for achieving <a href="https://docs.microsoft.com/en-us/dotnet/standard/modern-web-apps-azure-architecture/architectural-principles#dependency-inversion"><strong>Inversion of Control (IoC)</strong></a> between classes and their dependencies.

In our case UsersController depends on UsersService. 

There might be a case when JsonPlaceholder won‚Äôt response to our requests. In this case we would want to use another implementation of UsersService (use another source or provide mocked data). We would need to go through our app and change class name manually in all places where it‚Äôs used.

With DI we can do it easily in one place (ConfigureServices() in Startup.cs). Moreover, in .NET Core DI container can create instances of dependencies of dependencies. Otherwise we would need to do it manually in every service. In addition to that, .NET Core DI container takes on the responsibility of creating an instance of the dependency and disposing of it when it's no longer needed.

There are a few service lifetime options:
<strong>Singleton</strong> ‚Äî services are created the first time they're requested (or when ConfigureServices is run and an instance is specified with the service registration). Every subsequent request uses the same instance.
<strong>Scoped</strong> ‚Äî services are created once per client request (connection).
<strong>Transient</strong> ‚Äî services are created each time they're requested from the service container. This lifetime works best for lightweight, stateless services.

Let‚Äôs apply it for our UsersService:

Add the next code to `ConfigureServices() [Startup.cs]`

<SnippetL04S01 />

And update UsersController‚Äôs constructor:

<SnippetL04S02 />

Going further, we can create an interface for UsersService. It will let us switch services in one place.

Change the previous version of service registration to the next one:

<SnippetL04S03 />

Update UsersController to operate with the interface (notice how we got rid of explicit class name):

<SnippetL04S04 />

Don‚Äôt forget to inherit our UsersService from IUsersService:

`public class UsersService : IUsersService`

<h4>Middleware</h4>
Middleware is software that's assembled into an app pipeline to handle requests and responses.
Long story short: the app applies all middlewares one by one for each request.

![php-fpm_nginx](https://docs.microsoft.com/en-us/aspnet/core/fundamentals/middleware/index/_static/request-delegate-pipeline.png?view=aspnetcore-2.2)

For example, if you want to log all the requests, you can add a pipeline. <em>(I use Console.WriteLine for simplicity. You can use any logging framework here.)</em>

Add the next code info Configure method [Startup.cs]:

<SnippetL04S05 />

Then start the app, send request and see the console output.

<h4>Routing</h4>

Routing is responsible for mapping request URIs to endpoint selectors and dispatching incoming requests to endpoints. 

Routes are defined in the app and configured when the app starts. A route can optionally extract values from the URL contained in the request, and these values can then be used for request processing. Basically, routing is a middleware. Using the picture above, imagine how request comes to the server, then it‚Äôs being processed by a chain of middlewares and then routing middleware matches URL to controller and method names.

In WebAPI we define route using attribute Route.

<SnippetL04S06 />

We can do the same for methods in controller.


export const metadata = {
  author: "Nikita Krasnov",
  title: "How ASP.NET Core works",
  description: "",
  keywords: ["hola", "guapa"]
}

export default Lecture;
